
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Constitutive Models &#8212; Materialite</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'demos/constitutive_models';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Constitutive Models: Deep Dive" href="constitutive_models2.html" />
    <link rel="prev" title="IPF Coloring" href="ipf_example.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Materialite - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Materialite - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Materialite (Alpha Release)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="simple_example.html">Simple Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="material_basics.html">Material Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="material_plot.html">Material Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="material_phase.html">Material Phases</a></li>
<li class="toctree-l1"><a class="reference internal" href="regional_fields.html">Regional Fields</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tensor/Crystallography Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tensors.html">Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="orientations.html">Orientations</a></li>
<li class="toctree-l1"><a class="reference internal" href="crystallography.html">Crystallography</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipf_example.html">IPF Coloring</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mechanical Model Demos</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Constitutive Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="constitutive_models2.html">Constitutive Models: Deep Dive</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Thermal/Process Model Demos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="convolution.html">Convolution Thermal</a></li>
<li class="toctree-l1"><a class="reference internal" href="grain_coarsening.html">Grain Coarsening</a></li>
<li class="toctree-l1"><a class="reference internal" href="laser_pathing.html">AM Laser Pathing</a></li>
<li class="toctree-l1"><a class="reference internal" href="convolution_microstructure.html">AM Microstucture</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model-Making Demo</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="model_making.html">Creating New Models</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">Modules</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/nasa/materialite" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nasa/materialite/edit/main/docs/_sources/demos/constitutive_models.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nasa/materialite/issues/new?title=Issue%20on%20page%20%2Fdemos/constitutive_models.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/demos/constitutive_models.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Constitutive Models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="constitutive-models">
<h1>Constitutive Models<a class="headerlink" href="#constitutive-models" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">materialite</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Material</span><span class="p">,</span>
    <span class="n">Sphere</span><span class="p">,</span>
    <span class="n">Order2SymmetricTensor</span><span class="p">,</span>
    <span class="n">Order4SymmetricTensor</span><span class="p">,</span>
    <span class="n">Orientation</span><span class="p">,</span>
    <span class="n">SlipSystem</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">materialite.models.small_strain_fft</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">SmallStrainFFT</span><span class="p">,</span>
    <span class="n">LoadSchedule</span><span class="p">,</span>
    <span class="n">Elastic</span><span class="p">,</span>
    <span class="n">ElasticViscoplastic</span><span class="p">,</span>
    <span class="n">IsotropicElasticPlastic</span><span class="p">,</span>
    <span class="n">voce</span><span class="p">,</span>
    <span class="n">linear</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Example 1: Uniaxial tension with linear elasticity</strong></p>
<p>First, create a <code class="docutils literal notranslate"><span class="pre">Material</span></code> with an “orientation” field set to the identity everywhere. <code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code> requires information about the orientation of each point, although this is only relevant for anisotropic constitutive laws.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span><span class="o">.</span><span class="n">create_uniform_field</span><span class="p">(</span>
    <span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code> requires a constitutive model and the boundary conditions as inputs. Here, we define a simple linear elastic model. The only input is the stiffness tensor. We will use units of MPa throughout.</p>
<p>The boundary conditions come from a <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> object. Here, we define uniaxial tension in the <code class="docutils literal notranslate"><span class="pre">z</span></code> direction with a strain rate of <span class="math notranslate nohighlight">\(1 /\mathrm{s}\)</span> (i.e., <span class="math notranslate nohighlight">\(\dot{E}_{33} = 1/\mathrm{s}\)</span>, with all average stress components other than <span class="math notranslate nohighlight">\(\Sigma_{33}\)</span> equal to zero)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stiffness_tensor</span> <span class="o">=</span> <span class="n">Order4SymmetricTensor</span><span class="o">.</span><span class="n">from_isotropic_constants</span><span class="p">(</span>
    <span class="n">modulus</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">shear_modulus</span><span class="o">=</span><span class="mi">77000</span>
<span class="p">)</span>
<span class="n">constitutive_model</span> <span class="o">=</span> <span class="n">Elastic</span><span class="p">(</span><span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness_tensor</span><span class="p">)</span>
<span class="n">load_schedule</span> <span class="o">=</span> <span class="n">LoadSchedule</span><span class="o">.</span><span class="n">from_constant_uniaxial_strain_rate</span><span class="p">(</span>
    <span class="n">magnitude</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;z&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can instantiate and run the model. <code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code> takes the following inputs:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> object we created.</p></li>
<li><p>The end time of the simulation.</p></li>
<li><p>The initial time increment.</p></li>
<li><p>The constitutive model we defined.</p></li>
</ul>
<p>We will take one time increment of <span class="math notranslate nohighlight">\(0.001\)</span> s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SmallStrainFFT</span><span class="p">(</span>
    <span class="n">load_schedule</span><span class="o">=</span><span class="n">load_schedule</span><span class="p">,</span>
    <span class="n">end_time</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">initial_time_increment</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">constitutive_model</span><span class="o">=</span><span class="n">constitutive_model</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Running the model adds stress and strain field to the <code class="docutils literal notranslate"><span class="pre">Material</span></code>. The stress has one nonzero component, which is the same everywhere and simply equal to the total applied strain multiplied by Young’s modulus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">stress_voigt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-7.10542736e-15, -1.42108547e-14,  2.00000000e+02,  0.00000000e+00,
        0.00000000e+00,  0.00000000e+00])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color_lims</span><span class="o">=</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="mi">210</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fc6ab35aea4457be02bd90817a9d91a722d8f3975d9680ba4f0e6ff7c4c5c83f.png" src="../_images/fc6ab35aea4457be02bd90817a9d91a722d8f3975d9680ba4f0e6ff7c4c5c83f.png" />
</div>
</div>
<p><strong>Example 2: Uniaxial tension with isotropic plasticity</strong></p>
<p>This is very similar to the elastic simulation. We define a <code class="docutils literal notranslate"><span class="pre">Material</span></code>, an isotropic elastic-plastic constitutive model, and the same <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> as before. The new constitutive model requires:</p>
<ul class="simple">
<li><p>Young’s modulus</p></li>
<li><p>Shear modulus</p></li>
<li><p>Initial yield stress</p></li>
<li><p>Hardening law. Here, we use linear hardening.</p></li>
<li><p>Hardening properties</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span><span class="o">.</span><span class="n">create_uniform_field</span><span class="p">(</span>
    <span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">stiffness_tensor</span> <span class="o">=</span> <span class="n">Order4SymmetricTensor</span><span class="o">.</span><span class="n">from_isotropic_constants</span><span class="p">(</span>
    <span class="n">modulus</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">shear_modulus</span><span class="o">=</span><span class="mi">77000</span>
<span class="p">)</span>
<span class="n">constitutive_model</span> <span class="o">=</span> <span class="n">IsotropicElasticPlastic</span><span class="p">(</span>
    <span class="n">modulus</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
    <span class="n">shear_modulus</span><span class="o">=</span><span class="mi">77000</span><span class="p">,</span>
    <span class="n">yield_stress</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">hardening_function</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span>
    <span class="n">hardening_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hardening_rate&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">load_schedule</span> <span class="o">=</span> <span class="n">LoadSchedule</span><span class="o">.</span><span class="n">from_constant_uniaxial_strain_rate</span><span class="p">(</span>
    <span class="n">magnitude</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;z&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Running the model is similar to before. Now the total time of the simulation will be <span class="math notranslate nohighlight">\(0.01\)</span> s, corresponding to <span class="math notranslate nohighlight">\(1\%\)</span> strain. We will also request stress and strain output at several times during the simulation so that we can construct the stress-strain curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SmallStrainFFT</span><span class="p">(</span>
    <span class="n">load_schedule</span><span class="o">=</span><span class="n">load_schedule</span><span class="p">,</span>
    <span class="n">end_time</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">initial_time_increment</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">constitutive_model</span><span class="o">=</span><span class="n">constitutive_model</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">num_output_times</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">output_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_output_times</span><span class="p">)</span>
<span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">output_times</span><span class="o">=</span><span class="n">output_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now the “stress” and “strain” fields in the <code class="docutils literal notranslate"><span class="pre">Material</span></code> contain the pointwise stresses and strains across all the requested output times. Each will be an <code class="docutils literal notranslate"><span class="pre">Order2SymmetricTensor</span></code> with dimensions “p” (for each point in space) and “t” (for each time step). See the Tensor Demo for details. Here, we’ll verify the dimensions and print the stress at the end of the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stress</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stress dimensions: </span><span class="si">{</span><span class="n">stress</span><span class="o">.</span><span class="n">dims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stress</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stress dimensions: pt
Order2SymmetricTensor([[-1.27897692e-13 -1.27897692e-13  3.07467637e+02  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [-1.27897692e-13 -1.27897692e-13  3.07467637e+02  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [-1.27897692e-13 -1.27897692e-13  3.07467637e+02  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 ...
 [-1.27897692e-13 -1.27897692e-13  3.07467637e+02  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [-1.27897692e-13 -1.27897692e-13  3.07467637e+02  0.00000000e+00
   0.00000000e+00  0.00000000e+00]
 [-1.27897692e-13 -1.27897692e-13  3.07467637e+02  0.00000000e+00
   0.00000000e+00  0.00000000e+00]], dims: (points), components shape: (512, 6))
</pre></div>
</div>
</div>
</div>
<p>Extract the mean stress and strain in the material in the loading direction for each time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stress</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;strain&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the mean stress-strain curve. Add a point at (0,0) for visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Axial strain [-]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Axial stress [MPa]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Axial stress [MPa]&#39;)
</pre></div>
</div>
<img alt="../_images/498d63b25c2f30ae1919e0e24f624f781ad08268d8184ddb3b37a384fa5c7121.png" src="../_images/498d63b25c2f30ae1919e0e24f624f781ad08268d8184ddb3b37a384fa5c7121.png" />
</div>
</div>
<p>Plot the axial stress (normal stress in the loading direction) at each point. <code class="docutils literal notranslate"><span class="pre">material.plot()</span></code> automatically plots the value at the last time step/end of the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color_lims</span><span class="o">=</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">310</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/de81783ac97ce3131215c7251846775118806a4235f4a3af0eea40f542f6d938.png" src="../_images/de81783ac97ce3131215c7251846775118806a4235f4a3af0eea40f542f6d938.png" />
</div>
</div>
<p><strong>Example 3: Uniaxial tension of a single-phase FCC material</strong></p>
<p>First, create a <code class="docutils literal notranslate"><span class="pre">Material</span></code> with a periodic Voronoi tesselation of grains, each of which has a random orientation. Visualize the grain structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_grains</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">grains_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_grains</span><span class="p">)</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">material</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Material</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>
    <span class="o">.</span><span class="n">create_voronoi</span><span class="p">(</span><span class="n">num_grains</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;grain&quot;</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign_random_orientations</span><span class="p">(</span>
        <span class="n">region_label</span><span class="o">=</span><span class="s2">&quot;grain&quot;</span><span class="p">,</span> <span class="n">orientation_label</span><span class="o">=</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">material</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;grain&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/077987ee23c733d0e53f11c7e7399ef30a49f24a74c9307123f0e015de78a9b6.png" src="../_images/077987ee23c733d0e53f11c7e7399ef30a49f24a74c9307123f0e015de78a9b6.png" />
</div>
</div>
<p>Next, we define a crystalline elastic-viscoplastic constitutive model with a Voce hardening law for the material.</p>
<ul class="simple">
<li><p>Stiffness tensor, <span class="math notranslate nohighlight">\(\mathbb{C}\)</span></p></li>
<li><p>Slip systems operative in the material. We assume an FCC material here, so the octahedral slip systems are active.</p></li>
<li><p>Reference slip rate, <span class="math notranslate nohighlight">\(\dot{\gamma}_0\)</span></p></li>
<li><p>Rate exponent, <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p>Initial slip resistance, <span class="math notranslate nohighlight">\(\tau_0\)</span></p></li>
<li><p>Voce hardening law parameters: <span class="math notranslate nohighlight">\(\tau_1\)</span>, <span class="math notranslate nohighlight">\(\theta_0\)</span>, <span class="math notranslate nohighlight">\(\theta_1\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stiffness_tensor</span> <span class="o">=</span> <span class="n">Order4SymmetricTensor</span><span class="o">.</span><span class="n">from_cubic_constants</span><span class="p">(</span>
    <span class="n">C11</span><span class="o">=</span><span class="mi">243300</span><span class="p">,</span> <span class="n">C12</span><span class="o">=</span><span class="mi">156700</span><span class="p">,</span> <span class="n">C44</span><span class="o">=</span><span class="mi">117800</span>
<span class="p">)</span>
<span class="n">constitutive_model</span> <span class="o">=</span> <span class="n">ElasticViscoplastic</span><span class="p">(</span>
    <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness_tensor</span><span class="p">,</span>
    <span class="n">slip_systems</span><span class="o">=</span><span class="n">SlipSystem</span><span class="o">.</span><span class="n">octahedral</span><span class="p">(),</span>
    <span class="n">reference_slip_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">rate_exponent</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">slip_resistance</span><span class="o">=</span><span class="mf">143.0</span><span class="p">,</span>
    <span class="n">hardening_function</span><span class="o">=</span><span class="n">voce</span><span class="p">,</span>
    <span class="n">hardening_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tau_1&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s2">&quot;theta_0&quot;</span><span class="p">:</span> <span class="mf">1450.0</span><span class="p">,</span> <span class="s2">&quot;theta_1&quot;</span><span class="p">:</span> <span class="mf">95.0</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we’ll still apply a constant uniaxial strain rate, but using a more general <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> constructor, <code class="docutils literal notranslate"><span class="pre">LoadSchedule.from_constant_rates()</span></code>, as a demonstration. The inputs are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">strain_rate</span></code>: constant mean strain rate during the simulation; must be an <code class="docutils literal notranslate"><span class="pre">Order2SymmetricTensor</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stress_rate</span></code>: constant mean stress rate during the simulation; must be an <code class="docutils literal notranslate"><span class="pre">Order2SymmetricTensor</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stress_mask</span></code>: numpy array with six values, where each value is a <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code>. Indices correspond to the Voigt components of the <code class="docutils literal notranslate"><span class="pre">stress_rate</span></code>. <code class="docutils literal notranslate"><span class="pre">1</span></code> indicates that the corresponding mean stress component in <code class="docutils literal notranslate"><span class="pre">stress_rate</span></code> is enforced in the simulation. <code class="docutils literal notranslate"><span class="pre">0</span></code> indicates that the corresponding mean strain rate is enforced in the simulation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strain_rate</span> <span class="o">=</span> <span class="n">Order2SymmetricTensor</span><span class="o">.</span><span class="n">from_strain_voigt</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">stress_rate</span> <span class="o">=</span> <span class="n">Order2SymmetricTensor</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
<span class="n">stress_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">load_schedule</span> <span class="o">=</span> <span class="n">LoadSchedule</span><span class="o">.</span><span class="n">from_constant_rates</span><span class="p">(</span>
    <span class="n">strain_rate</span><span class="o">=</span><span class="n">strain_rate</span><span class="p">,</span> <span class="n">stress_rate</span><span class="o">=</span><span class="n">stress_rate</span><span class="p">,</span> <span class="n">stress_mask</span><span class="o">=</span><span class="n">stress_mask</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The constitutive models can have some internal state variables that we may be interested in. Each one comes with an <code class="docutils literal notranslate"><span class="pre">available_state_variables</span></code> attribute that you can query.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">constitutive_model</span><span class="o">.</span><span class="n">available_state_variables</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;slip_resistances&#39;, &#39;plastic_strains&#39;, &#39;slip_system_shear_strains&#39;]
</pre></div>
</div>
</div>
</div>
<p>Creating and running the <code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code> model proceeds as before. Here, we will request slip system shear strain outputs using the <code class="docutils literal notranslate"><span class="pre">output_variables</span></code> keyword argument, which must be a list. We will also use Python’s <code class="docutils literal notranslate"><span class="pre">logging</span></code> module to get information during the simulation.  <code class="docutils literal notranslate"><span class="pre">INFO</span></code> marks the start of new increments. <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> provides additional debugging information related to convergence.</p>
<p>NOTE: The syntax of the <code class="docutils literal notranslate"><span class="pre">logging</span></code> module can be tricky. We suggest calling <code class="docutils literal notranslate"><span class="pre">logging.basicConfig()</span></code> immediately after importing <code class="docutils literal notranslate"><span class="pre">logging</span></code> to set up the logger. Then you can choose the outputs you want by calling <code class="docutils literal notranslate"><span class="pre">logger</span> <span class="pre">=</span> <span class="pre">logging.getLogger()</span></code> followed by <code class="docutils literal notranslate"><span class="pre">logger.setLevel(...)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SmallStrainFFT</span><span class="p">(</span>
    <span class="n">load_schedule</span><span class="o">=</span><span class="n">load_schedule</span><span class="p">,</span>
    <span class="n">end_time</span><span class="o">=</span><span class="mf">0.007</span><span class="p">,</span>
    <span class="n">initial_time_increment</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">constitutive_model</span><span class="o">=</span><span class="n">constitutive_model</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">num_output_times</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">output_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">0.007</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_output_times</span><span class="p">)</span>

<span class="c1"># Set up logger</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">output_times</span><span class="o">=</span><span class="n">output_times</span><span class="p">,</span> <span class="n">output_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slip_system_shear_strains&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Reset logger to WARNING to avoid INFO outputs from PyVista</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.0 + 0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.001 + 0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.002 + 0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.003 + 0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.004 + 0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.005 + 0.001
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:SmallStrainFFT:New increment: time 0.006 + 0.001
</pre></div>
</div>
</div>
</div>
<p>Plot the mean stress-strain curve and the axial stress field. Note that the stress field is now inhomogeneous.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stress</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;strain&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;axial strain&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;axial stress [MPa]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;axial stress [MPa]&#39;)
</pre></div>
</div>
<img alt="../_images/5127795d3170c7b8afcd1b722a314e7b9d966d0b195963b75194efcf47606178.png" src="../_images/5127795d3170c7b8afcd1b722a314e7b9d966d0b195963b75194efcf47606178.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8ae786a3bf0765c743863674547a6a2d74d7c787d874f82e9446e0cf38329b55.png" src="../_images/8ae786a3bf0765c743863674547a6a2d74d7c787d874f82e9446e0cf38329b55.png" />
</div>
</div>
<p>The slip system shear strains at each requested output time will now be added to <code class="docutils literal notranslate"><span class="pre">material.fields</span></code>, in addition to the stress and strain. The <code class="docutils literal notranslate"><span class="pre">Materialite</span></code> <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> stored in the “slip_system_shear_strains” field will be a <code class="docutils literal notranslate"><span class="pre">Scalar</span></code> with dimensions “p”, “s”, and “t”, representing the shear strain at each point, on each slip system, at each output time. Look at the slip system shear strains at the end of the simulation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slip_system_shear_strains</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;slip_system_shear_strains&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slip system shear strain dimensions: </span><span class="si">{</span><span class="n">slip_system_shear_strains</span><span class="o">.</span><span class="n">dims</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slip_system_shear_strains</span><span class="p">[:,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Slip system shear strain dimensions: pst
Scalar([[ 7.78371938e-04  1.29891163e-04 -1.51862619e-09 ...  6.97309063e-05
  -4.07851814e-11 -3.42271114e-04]
 [ 4.86942556e-12 -1.49340991e-03 -5.38309705e-03 ... -2.84103837e-05
   1.15577790e-06  5.11345257e-03]
 [-6.34021852e-10  9.05740359e-15  7.30094413e-09 ... -2.36383924e-03
   4.70063086e-12  3.94256276e-03]
 ...
 [ 3.82444110e-05  7.98865119e-09 -2.40589842e-07 ...  7.46152846e-06
  -5.51309345e-08 -8.28091687e-04]
 [ 2.61875422e-05  2.22517239e-08 -5.13988140e-08 ...  2.92375692e-05
  -9.93742017e-08 -2.13355818e-03]
 [ 7.54850493e-05  9.00377902e-07 -4.86269023e-09 ...  1.32271909e-04
  -1.44103654e-08 -2.85620189e-03]], dims: (points, slip systems), components shape: (4096, 12))
</pre></div>
</div>
</div>
</div>
<p><strong>Example 4: Uniaxial tension of a single crystal with a pore</strong></p>
<p>Here, we will simulate a plastically deforming matrix with a pore in the center. In this case, we need to assign a field to the material that identifies the phase (1 for the matrix and 2 for the pore).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midpoint</span> <span class="o">=</span> <span class="mf">7.5</span>
<span class="n">material</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Material</span><span class="p">(</span><span class="n">dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>
    <span class="o">.</span><span class="n">create_uniform_field</span><span class="p">(</span><span class="s2">&quot;orientation&quot;</span><span class="p">,</span> <span class="n">Orientation</span><span class="o">.</span><span class="n">identity</span><span class="p">())</span>
    <span class="o">.</span><span class="n">create_uniform_field</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">insert_feature</span><span class="p">(</span>
        <span class="n">Sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">centroid</span><span class="o">=</span><span class="p">[</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">midpoint</span><span class="p">,</span> <span class="n">midpoint</span><span class="p">]),</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">material</span><span class="o">.</span><span class="n">crop_by_range</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">material</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dad14282e3e197599e6f2840bb44abd27b024da572bfbe1cfa844d4b2d7a816f.png" src="../_images/dad14282e3e197599e6f2840bb44abd27b024da572bfbe1cfa844d4b2d7a816f.png" />
</div>
</div>
<p>We will define separate constitutive models for the crystal and the pore. The pore will be an elastic model with zero stiffness. Materialite uses the method in refs. [3-4] to handle the infinite stiffness contrast between the pore and the solid material without convergence issues.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stiffness_tensor</span> <span class="o">=</span> <span class="n">Order4SymmetricTensor</span><span class="o">.</span><span class="n">from_cubic_constants</span><span class="p">(</span>
    <span class="n">C11</span><span class="o">=</span><span class="mi">243300</span><span class="p">,</span> <span class="n">C12</span><span class="o">=</span><span class="mi">156700</span><span class="p">,</span> <span class="n">C44</span><span class="o">=</span><span class="mi">117800</span>
<span class="p">)</span>
<span class="n">evp_model</span> <span class="o">=</span> <span class="n">ElasticViscoplastic</span><span class="p">(</span>
    <span class="n">stiffness</span><span class="o">=</span><span class="n">stiffness_tensor</span><span class="p">,</span>
    <span class="n">slip_systems</span><span class="o">=</span><span class="n">SlipSystem</span><span class="o">.</span><span class="n">octahedral</span><span class="p">(),</span>
    <span class="n">reference_slip_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">rate_exponent</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">slip_resistance</span><span class="o">=</span><span class="mf">143.0</span><span class="p">,</span>
    <span class="n">hardening_function</span><span class="o">=</span><span class="n">voce</span><span class="p">,</span>
    <span class="n">hardening_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;tau_1&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s2">&quot;theta_0&quot;</span><span class="p">:</span> <span class="mf">1450.0</span><span class="p">,</span> <span class="s2">&quot;theta_1&quot;</span><span class="p">:</span> <span class="mf">95.0</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">pore_model</span> <span class="o">=</span> <span class="n">Elastic</span><span class="p">(</span><span class="n">stiffness_tensor</span> <span class="o">*</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The constitutive models are associated with the correct phases by creating a regional field in the <code class="docutils literal notranslate"><span class="pre">Material</span></code>. The constitutive model field must be named <code class="docutils literal notranslate"><span class="pre">constitutive_model</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phases</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">evp_model</span><span class="p">,</span> <span class="n">pore_model</span><span class="p">]</span>
<span class="n">regional_fields</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;phase&quot;</span><span class="p">:</span> <span class="n">phases</span><span class="p">,</span> <span class="s2">&quot;constitutive_model&quot;</span><span class="p">:</span> <span class="n">models</span><span class="p">})</span>
<span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">create_regional_fields</span><span class="p">(</span>
    <span class="n">region_label</span><span class="o">=</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span> <span class="n">regional_fields</span><span class="o">=</span><span class="n">regional_fields</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Look at what we’ve added to the <code class="docutils literal notranslate"><span class="pre">Material</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>x_id</th>
      <th>y_id</th>
      <th>z_id</th>
      <th>orientation</th>
      <th>phase</th>
      <th>constitutive_model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4091</th>
      <td>15</td>
      <td>15</td>
      <td>11</td>
      <td>15</td>
      <td>15</td>
      <td>11</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>4092</th>
      <td>15</td>
      <td>15</td>
      <td>12</td>
      <td>15</td>
      <td>15</td>
      <td>12</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>4093</th>
      <td>15</td>
      <td>15</td>
      <td>13</td>
      <td>15</td>
      <td>15</td>
      <td>13</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>4094</th>
      <td>15</td>
      <td>15</td>
      <td>14</td>
      <td>15</td>
      <td>15</td>
      <td>14</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
    <tr>
      <th>4095</th>
      <td>15</td>
      <td>15</td>
      <td>15</td>
      <td>15</td>
      <td>15</td>
      <td>15</td>
      <td>Orientation([0. 0. 0.], dims: (), Euler angles...</td>
      <td>1</td>
      <td>ElasticViscoplastic(stiffness=[[243300. 156700...</td>
    </tr>
  </tbody>
</table>
<p>4096 rows × 9 columns</p>
</div></div></div>
</div>
<p>We will use the same <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> again. Note that no constitutive model is passed to <code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_schedule</span> <span class="o">=</span> <span class="n">LoadSchedule</span><span class="o">.</span><span class="n">from_constant_uniaxial_strain_rate</span><span class="p">(</span>
    <span class="n">magnitude</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;z&quot;</span>
<span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SmallStrainFFT</span><span class="p">(</span>
    <span class="n">load_schedule</span><span class="o">=</span><span class="n">load_schedule</span><span class="p">,</span>
    <span class="n">end_time</span><span class="o">=</span><span class="mf">0.007</span><span class="p">,</span>
    <span class="n">initial_time_increment</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Run the model. We specify <code class="docutils literal notranslate"><span class="pre">phase_label=&quot;phase&quot;</span></code> to tell the model to look at the <code class="docutils literal notranslate"><span class="pre">Material</span></code> field called <code class="docutils literal notranslate"><span class="pre">phase</span></code> to determine which points belong to which constitutive model. We will ask for the slip system shear strains as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_output_times</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">output_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mf">0.007</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_output_times</span><span class="p">)</span>
<span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">phase_label</span><span class="o">=</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span>
    <span class="n">output_times</span><span class="o">=</span><span class="n">output_times</span><span class="p">,</span>
    <span class="n">output_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;slip_system_shear_strains&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Compare the mean stress in the pore and solid material at each output time. As expected, the stress is zero at all points in the pore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">get_region_indices</span><span class="p">(</span><span class="s2">&quot;phase&quot;</span><span class="p">)</span>
<span class="n">pore_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">solid_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">stress</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">)</span>
<span class="n">pore_stress</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[</span><span class="n">pore_indices</span><span class="p">]</span>
<span class="n">solid_stress</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[</span><span class="n">solid_indices</span><span class="p">]</span>
<span class="n">mean_pore_stress</span> <span class="o">=</span> <span class="n">pore_stress</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">stress_voigt</span>
<span class="n">mean_solid_stress</span> <span class="o">=</span> <span class="n">solid_stress</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">stress_voigt</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean pore stress: </span><span class="si">{</span><span class="n">mean_pore_stress</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mean solid stress: </span><span class="si">{</span><span class="n">mean_solid_stress</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean pore stress: [[0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]
 [0. 0. 0. 0. 0. 0.]]
mean solid stress: [[-4.01771088e-05 -4.01771088e-05  1.17721036e+02  2.28624890e-17
   2.91839945e-17 -7.66510416e-17]
 [ 4.83460989e-06  4.83460989e-06  2.27039459e+02 -4.98955361e-17
  -6.30415911e-17 -6.34380791e-19]
 [ 6.07083720e-04  6.07083720e-04  2.83311972e+02 -7.65204299e-10
   2.26066458e-10 -1.46598899e-10]
 [ 1.65822596e-04  1.65822596e-04  3.03365583e+02 -1.65927787e-09
  -5.30326617e-09 -1.90904788e-08]
 [-2.78437840e-03 -2.78437840e-03  3.12933310e+02 -1.62440466e-09
  -2.86660059e-10  5.36530042e-10]
 [-1.63973267e-03 -1.63973267e-03  3.19798080e+02 -6.91754925e-08
  -5.46264725e-09  7.43628536e-09]
 [-4.44322799e-04 -4.44322799e-04  3.25746691e+02 -1.42570443e-08
  -3.13907645e-09  9.02664918e-09]]
</pre></div>
</div>
</div>
</div>
<p>Plot stress field of half the material to show stress near the pore</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">material</span><span class="o">.</span><span class="n">crop_by_range</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">material</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="s2">&quot;stress&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/17da39294f059331267b31dc7d4b185864fb897585d30b384411653aaea74fe1.png" src="../_images/17da39294f059331267b31dc7d4b185864fb897585d30b384411653aaea74fe1.png" />
</div>
</div>
<p>Plot the mean stress-strain curve</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stress</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;stress&quot;</span><span class="p">)</span>
<span class="n">strain</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;strain&quot;</span><span class="p">)</span>
<span class="n">stress_solid</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[</span><span class="n">solid_indices</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">strain_solid</span> <span class="o">=</span> <span class="n">strain</span><span class="p">[</span><span class="n">solid_indices</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">stress_pore</span> <span class="o">=</span> <span class="n">stress</span><span class="p">[</span><span class="n">pore_indices</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">strain_pore</span> <span class="o">=</span> <span class="n">strain</span><span class="p">[</span><span class="n">pore_indices</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">strain_solid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stress_solid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">strain_pore</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">stress_pore</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;pore&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Axial strain [-]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Axial stress [MPa]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Axial stress [MPa]&#39;)
</pre></div>
</div>
<img alt="../_images/0759a65883456cfef922aef8df355017c7543ddd1dbbdb4aa2e6bb14266b905f.png" src="../_images/0759a65883456cfef922aef8df355017c7543ddd1dbbdb4aa2e6bb14266b905f.png" />
</div>
</div>
<p>Look at the slip system shear strains at the end of the simulation. Note that the values default to zero in the pore since this is not an available state variable in <code class="docutils literal notranslate"><span class="pre">Elastic</span></code> models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slip_system_shear_strains</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;slip_system_shear_strains&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slip_system_shear_strains</span><span class="p">[</span><span class="n">solid_indices</span><span class="p">,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">slip_system_shear_strains</span><span class="p">[</span><span class="n">pore_indices</span><span class="p">,</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scalar([[-1.97058407e-003 -1.97058407e-003  3.38956002e-104 ... -2.00352402e-003
  -2.00352402e-003  8.51426859e-105]
 [-1.80843984e-003 -1.80843984e-003  3.15201546e-105 ... -1.91844977e-003
  -1.91844977e-003 -2.21000386e-106]
 [-1.54129130e-003 -1.54129130e-003 -2.94527937e-102 ... -1.68872123e-003
  -1.68872123e-003  1.33933569e-102]
 ...
 [-1.54129130e-003 -1.54129130e-003 -6.69430773e-102 ... -1.68872123e-003
  -1.68872123e-003  3.65619153e-103]
 [-1.80843984e-003 -1.80843984e-003  4.36549984e-105 ... -1.91844977e-003
  -1.91844977e-003 -2.13557488e-106]
 [-1.97058407e-003 -1.97058407e-003  3.54436710e-104 ... -2.00352402e-003
  -2.00352402e-003 -2.41190948e-105]], dims: (points, slip systems), components shape: (3960, 12))
Scalar([[0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 ...
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]], dims: (points, slip systems), components shape: (136, 12))
</pre></div>
</div>
</div>
</div>
<p><strong>Additional notes</strong></p>
<p>There are also <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> constructors for strain- and stress-based cyclic loading. Each one requires an amplitude, a frequency, and a stress mask.</p>
<p>The stress mask is a numpy array of length 6 that contains only 1s and 0s. 1s correspond to components where the mean stress is prescribed; 0s correspond to components where the mean strain is prescribed. The components are in the standard Voigt order (<code class="docutils literal notranslate"><span class="pre">[xx,</span> <span class="pre">yy,</span> <span class="pre">zz,</span> <span class="pre">yz,</span> <span class="pre">xz,</span> <span class="pre">xy]</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strain_amplitude</span> <span class="o">=</span> <span class="n">Order2SymmetricTensor</span><span class="o">.</span><span class="n">from_strain_voigt</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">stress_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">load_schedule</span> <span class="o">=</span> <span class="n">LoadSchedule</span><span class="o">.</span><span class="n">from_cyclic_strain</span><span class="p">(</span>
    <span class="n">strain_amplitude</span><span class="o">=</span><span class="n">strain_amplitude</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stress_mask</span><span class="o">=</span><span class="n">stress_mask</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stress_amplitude</span> <span class="o">=</span> <span class="n">Order2SymmetricTensor</span><span class="o">.</span><span class="n">from_stress_voigt</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">stress_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">load_schedule</span> <span class="o">=</span> <span class="n">LoadSchedule</span><span class="o">.</span><span class="n">from_cyclic_stress</span><span class="p">(</span>
    <span class="n">stress_amplitude</span><span class="o">=</span><span class="n">stress_amplitude</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">stress_mask</span><span class="o">=</span><span class="n">stress_mask</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can also create your own <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code>. You need to provide:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">strain_increment</span></code>: a function that takes the previous time (<code class="docutils literal notranslate"><span class="pre">t</span></code>) and the current time increment (<code class="docutils literal notranslate"><span class="pre">dt</span></code>) as inputs and returns the mean strain increment as an <code class="docutils literal notranslate"><span class="pre">Order2SymmetricTensor</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">strain_increment(t,</span> <span class="pre">dt)</span> <span class="pre">-&gt;</span> <span class="pre">Order2SymmetricTensor</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stress_increment</span></code>: a function that takes <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">dt</span></code> as inputs and returns the mean stress increment as an <code class="docutils literal notranslate"><span class="pre">Order2SymmetricTensor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stress</span></code>: a function that takes <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">dt</span></code> as inputs and returns the new mean stress as an <code class="docutils literal notranslate"><span class="pre">Order2SymmetricTensor</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stress_mask</span></code>: same as the definition for all of the <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code>s above.</p></li>
</ul>
<p>Create an instance of your load schedule: <code class="docutils literal notranslate"><span class="pre">load_schedule</span> <span class="pre">=</span> <span class="pre">LoadSchedule(strain_increment,</span> <span class="pre">stress_increment,</span> <span class="pre">stress,</span> <span class="pre">stress_mask)</span></code></p>
<p>There are two other hardening laws that can be imported from <code class="docutils literal notranslate"><span class="pre">materialite.models.small_strain_fft</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">perfect_plasticity</span></code>: does not require any hardening law properties (i.e., <code class="docutils literal notranslate"><span class="pre">hardening_properties=None</span></code> in the constitutive law definition).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">armstrong_frederick</span></code>: hardening law of the form <span class="math notranslate nohighlight">\(\dot{g}_s = \left(H - H_d g_s \right) \dot{\Gamma}\)</span>. The two required hardening properties are “direct_hardening” (<span class="math notranslate nohighlight">\(H\)</span>) and “dynamic_recovery” (<span class="math notranslate nohighlight">\(H_d\)</span>).</p></li>
</ul>
<p>Other notes:</p>
<ul class="simple">
<li><p>When constitutive models are specified by phase (or another field in the <code class="docutils literal notranslate"><span class="pre">Material</span></code>), the model assumes there is a regional field associated with the phase called “constitutive_model”.</p></li>
<li><p>The model (<code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code>) increments the global stress and strain, uses conjugate gradients + FFTs [1,2] to estimate the global strain field given a guess global stress field, and asks the constitutive model for the updated global stress and consistent tangent fields.</p></li>
<li><p>When phase-dependent constitutive models are specified, <code class="docutils literal notranslate"><span class="pre">SmallStrainFFT</span></code> uses a “utility” constitutive model class called <code class="docutils literal notranslate"><span class="pre">Multiphase</span></code> (see <code class="docutils literal notranslate"><span class="pre">materialite.models.small_strain_fft.multiphase</span></code>). <code class="docutils literal notranslate"><span class="pre">Multiphase</span></code> pulls off the material points corresponding to each constitutive model, calls the constitutive models, and reconstructs the global stress and consistent tangent fields from the output of each constitutive model.</p></li>
<li><p>There are also <code class="docutils literal notranslate"><span class="pre">LoadSchedule</span></code> constructors for cyclic loading.</p></li>
</ul>
<p>[1] T.W.J. de Geus, J. Vondrejc, J. Zeman, R.H.J. Peerlings, M.G.D. Geers. Finite strain FFT-based non-linear solvers made simple. Computer Methods in Applied Mechanics and Engineering, 2017, 318:412–430. doi: 10.1016/j.cma.2016.12.032</p>
<p>[2] J. Zeman, T.W.J. de Geus, J. Vondrejc, R.H.J. Peerlings, M.G.D. Geers. A finite element perspective on nonlinear FFT-based micromechanical simulations. International Journal for Numerical Methods in Engineering, 2017, 111(10):903–926. doi: 10.1002/nme.5481</p>
<p>[3] F. Willot. Fourier-based schemes for computing the mechanical response of composites with accurate local fields. Comptes Rendus Mécanique, 2015, 343:232–245. doi: 10.1016/j.crme.2014.12.005</p>
<p>[4] S. Lucarini, L. Cobian, A. Voitus, J. Segurado. Adaptation and validation of FFT methods for homogenization of lattice based materials. Computer Methods in Applied Mechanics and Engineering, 2022, 388:114223. doi: 10.1016/j.cma.2021.114223</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./demos"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ipf_example.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">IPF Coloring</p>
      </div>
    </a>
    <a class="right-next"
       href="constitutive_models2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Constitutive Models: Deep Dive</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By NASA
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>